# 婶子和一博的日常拷打

旨在记录婶子拷打菜gou的日常问题  常看常新（不愧是婶子！！！

## 关于操作系统

Q：操作系统中有分段机制，那么将代码段和数据段分隔起来的好处是啥

A：

- 安全性：通过将数据段和代码段分隔开，可以更好地保护代码免受数据的污染或破坏。如果允许数据直接在代码段执行，恶意数据可能会覆盖关键的指令，导致程序错误或安全漏洞。
- 可维护性：分离数据和代码有助于代码的模块化和可维护性。程序员可以更容易地理解和维护代码，因为它们不会混合在一起，使得程序的结构更清晰。
- 内存保护：现代操作系统和硬件通常提供了内存保护机制，可以防止程序对不属于自己的内存区域进行读写操作。将数据和代码分隔开有助于操作系统实施内存保护，以防止非法访问。
- 缓存优化：分离数据和代码有助于缓存优化。现代计算机系统通常具有多级缓存，其中代码和数据可能分别存储在不同的缓存级别中。通过分离它们，可以更有效地利用缓存，提高程序的性能。
- 程序设计：将数据和代码分隔开有助于更好地组织程序的设计。程序员可以更容易地管理数据、实现数据结构，并将数据与代码的逻辑分开。

------

Q：内部中断和外部中断是啥

A：

1. **内部中断**：
   - **定义**：内部中断，也称为异常（Exception），是由**CPU内部或指令执行**引发的中断事件。这些事件通常是由于程序执行期间发生的错误或异常情况引起的，例如除以零、越界访问、非法操作码等。
   - **原因**：内部中断通常是由程序错误或异常情况引发的，这些情况可能需要中断正在执行的程序并将控制权转移到操作系统或异常处理程序，以进行适当的处理。
   - **举例**：除零异常、页错误、非法指令等。
2. **外部中断**：
   - **定义**：外部中断是由**CPU外部的硬件设备或外部事件**引发的中断事件。这些事件通常是来自外部设备的请求，例如键盘输入、鼠标点击、定时器中断、硬件故障等。
   - **原因**：外部中断是由外部设备或事件触发的，它们通常需要引起CPU的注意，并可能需要执行与外部事件相关的处理。
   - **举例**：键盘中断、鼠标中断、定时器中断、硬件故障中断等。

Q：那软中断和硬中断呢

A：

1. **软中断（Software Interrupt）**：
   - **定义**：软中断是由程序明确请求的中断，通常是通过系统调用（System Call）或特殊指令来触发的。它们是用户空间程序向内核（操作系统）请求服务或资源的一种方式。
   - **原因**：软中断通常由用户空间的程序请求操作系统执行特定任务，如文件读写、网络通信等。这种中断是可控的，由程序员明确调用。
   - **举例**：系统调用（如读取文件、发送网络数据）、异常处理（如除零异常处理）。
2. **硬中断（Hardware Interrupt）**：
   - **定义**：硬中断是由计算机硬件设备（如键盘、鼠标、定时器、硬盘控制器等）或外部事件引发的中断。它们是不可控的，由硬件设备产生，并通常需要操作系统来响应和处理。
   - **原因**：硬中断通常由硬件设备或外部事件触发，例如键盘输入、定时器中断、网络数据包到达等。操作系统必须准备好接受这些中断，以便及时响应。
   - **举例**：键盘中断、鼠标中断、定时器中断、磁盘中断、硬件错误中断等。

> 总结：
>
> 内部中断和外部中断是中断事件的两种主要类型，分别与中断的原因有关；硬中断和软中断是中断事件的两种主要类型，分别与中断的触发方式有关
>
> 内部中断可能包括硬中断，如硬件故障引发的异常，也可能包括软中断，如系统调用引发的异常。外部中断通常是硬中断，例如定时器中断或硬件设备中断。

------

Q：上下文切换

A：从一个线程切换到另一个线程需要保存旧线程的CPU寄存器，并恢复新线程之前保存的寄存器；堆栈指针和程序计数器的保存和恢复意味着CPU将切换堆栈并切换正在执行的代码。需要保存和恢复的寄存器组称为上下文



------

Q：内部碎片是什么 外部碎片是什么

A：内部碎片是已分配给进程但未被利用的内存空间，而外部碎片是未分配给任何进程的不连续的内存碎片。



------



## 关于网络

Q：为啥TCP流量控制已经有滑动窗口来解决了，但是还是会存在丢包现象

A：客户端和服务器端进行通信时中间必然会经过路由器，虽然通过滑动窗口两端已经协调好流量，但是路由器可能也会存在缓冲区限制。提一嘴，现在基本上都是分组交换，路由器会接收到一整个分组才会继续转发，当分组过多时就会存在分组等待队列，当队列满时，后到达的分组就会被丢弃。

其他原因还有

- **链路错误**：物理链路上的错误、干扰或噪声可能导致数据包损坏或丢失。TCP可以检测到这些错误并请求重传，但在某些情况下，数据包可能已经过期或不可用，无法恢复。
- **丢失的ACK**：TCP使用确认（ACK）来确认已接收的数据包。如果某个ACK丢失，发送方可能会重传数据包，导致冗余传输。如果重新传输的数据包在接收方已经接收并确认后才到达，接收方可能会忽略它，因为它已经处理过。这可能导致看似无法解释的丢包情况。

## 关于CPU

Q：CPU的分支预测

A：1. 流水线（Pipeline）：

流水线是 CPU 中的一种执行指令的机制，它将指令的执行过程划分为多个阶段，每个阶段执行一部分工作。这些阶段按顺序连接，使得在一个时钟周期内可以同时处理多条指令的不同阶段。流水线包括取指令、译码、执行、访存和写回等阶段。

优势：

- **提高吞吐量：** 多条指令可以同时在不同阶段执行，从而提高整体吞吐量。
- **更高的性能：** 流水线可以让 CPU 在一个时钟周期内完成更多的工作。

缺点：

- **数据相关性：** 流水线可能受到数据相关性（数据依赖）和控制相关性（分支预测失误）的影响，导致流水线中的阶段出现停顿。

分支预测（Branch Prediction）：

分支预测是为了解决分支指令（如条件跳转指令）对流水线效率的影响。当程序执行到分支语句时，如果分支的方向（跳转或不跳转）未知，流水线会停顿等待分支结果。为了减少这种停顿，采用了分支预测机制。

优势：

- **减少流水线停顿：** 分支预测能够尽可能提前猜测分支的方向，从而减少流水线停顿时间。

缺点：

- **预测错误的代价：** 如果分支预测错误，需要回滚之前的指令执行，这可能导致额外的性能开销。

**流水线和分支预测的关系**：

在流水线中，分支预测是为了解决由分支指令引起的停顿问题。分支预测机制尝试预测分支的方向，使得流水线能够继续执行而不受等待分支结果的影响。

------

Q：RVO和NRVO（cpp中编译器返回值优化)

A：

------

Q:终端中的top和htop查看cpu的占用率查看的是逻辑的还是物理的

A：是逻辑的。一个物理 CPU 可能包含多个逻辑 CPU 核心（Hyper-Threading 技术），每个核心都可以被视为一个逻辑 CPU。这种情况下，一个物理 CPU 上的任务可能并行执行在多个逻辑 CPU 核心上。但是这样会降低cpu的缓存命中率