## 分库分表
如果 MySQL 当中一张表的数据量过大（一般是在1000万左右适宜，具体取决于数据结构和索引），索引文件会过大，导致b+树高度过高（3层b+树可以索引上百万数据，每多一层就多一次磁盘io）导致查询等操作性能显著降低，所以需要对表数据进行拆分。

### 分库
分库主要是将数据库中的**数据分散到不同的数据库**上，有两种方案：水平分库和垂直分库。

**垂直分库**简单来说，是把单一数据库按照业务进行划分，不同的业务使用不同的数据库，进而分担数据库的压力。
- 比如说将数据库中的用户表、订单表和商品表分成用户数据库、订单数据库和商品数据库

**水平分库**是将**同一个表**拆分到不同数据库中，每个库可以位于不同服务器上，实现了水平扩展。
- 比如说，将一张表id范围为0-1000放在数据库1中，1001-2000放在数据库2中


### 分表
分表是对单表的数据进行拆分，同样有两种方式：水平和垂直。

垂直分表 是对数据表列的拆分，把一张列比较多的表拆分成多张表。水平分表是对数据表行的拆分，把一张行比较多的表拆分成多张表，可以解决单一表数据量过大的问题。 

**水平分表通常和水平分库同时出现。**

### 分片键如何选择
分片键是数据分片的关键，通过特定的规则将表中数据划分到多个分片当中。分片键一般具备如下特点：
- 具有离散性，能将数据均匀分散到各个分片中，避免数据倾斜和热点问题。
- 具有稳定性，分片键值一般不发生变化，避免数据迁移和一致性问题
- 具有共性，可以覆盖大多数查询场景，减少单次查询所涉及到的分片数量，降低数据库压力。

### 分库分表后的数据迁移
1、停机迁移：在系统使用人数较少时进行停机，将老库的数据迁移到新库中。

2、双写：对老库的更新操作，同时要写入新库（双写）。如果新库不存在这样的数据，则需要插入。同时，那些未被更新到的数据需要通过脚本迁移，直到老库数据和新库数据一致。